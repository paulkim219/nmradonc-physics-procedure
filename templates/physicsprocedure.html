<!doctype html>
<html lang="en" ng-app="radOncAIApp">
<head>
  <meta charset="utf-8">
  <title>RadOncAI Exam Simulator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body ng-controller="ExamController as vm">

  {% include 'components/navbar.html' %}

  <main class="chat-container">
    <div class="chat-header-bar">
      <div class="chat-header-content">
        <h1>RadOncAI Physics Procedure Chatbot</h1>
        {% raw %}
        <div class="header-meta">
          <button class="btn ghost btn-sm" ng-click="vm.resetSession()">Reset Session</button>
        </div>
        {% endraw %}
      </div>
    </div>

    <div class="chat-messages" aria-live="polite">
      {% raw %}

      <!-- Conversation messages -->
      <article class="message" ng-repeat="entry in vm.answerHistory track by $index" ng-class="{'user-message': entry.role === 'user', 'physics_procedure_agent-message': entry.role === 'physics_procedure_agent'}">
        <div class="message-avatar user-avatar" ng-if="entry.role === 'user'">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="currentColor"/>
          </svg>
        </div>
        <div class="message-content">
          <div class="message-text">
            <p>{{ entry.message }}</p>
          </div>
        </div>
        <div class="message-avatar" ng-if="entry.role === 'physics_procedure_agent'">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
          </svg>
        </div>
      </article>

      <!-- Loading indicator -->
      <article class="message user-message" ng-if="vm.isLoading">
        <div class="message-avatar">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
          </svg>
        </div>
        <div class="message-content">
          <div class="message-text">
            <p class="loading-text">Thinking...</p>
          </div>
        </div>
      </article>
      {% endraw %}
    </div>

    <div class="chat-input-container">
      <form class="chat-input-form" ng-submit="vm.sendAnswer()">
        <div class="input-container">
          <textarea 
            id="answer" 
            ng-model="vm.answer" 
            placeholder="Type your response here..." 
            ng-keydown="vm.handleAnswerKeydown($event)"
            ng-keyup="vm.autoResizeTextarea($event)"
            rows="1"
            required></textarea>
          <button type="submit" class="send-button" ng-disabled="!vm.answer.trim() || vm.isLoading">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" fill="currentColor"/>
            </svg>
          </button>
        </div>
      </form>
    </div>

    <div class="modal-overlay" ng-if="vm.showRatingModal">
      <div class="modal-content">
        <h3>Rate this Answer</h3>
        <p>How helpful was this response? (1-10)</p>
        
        <div class="rating-scale">
          <button 
            type="button" 
            ng-repeat="n in [1,2,3,4,5,6,7,8,9,10]" 
            ng-click="vm.currentRating = n"
            ng-class="{'active': vm.currentRating === n}"
            ng-bind="n"> </button>
        </div>
  
        <textarea 
          class="rating-comment" 
          ng-model="vm.ratingComment" 
          placeholder="Any additional feedback? (Optional)"
          rows="3">
        </textarea>
  
        <div class="modal-actions">
          <button class="btn-cancel" ng-click="vm.skipRating()">Skip</button>
          <button class="btn-submit" ng-click="vm.submitRating()" ng-disabled="!vm.currentRating">Submit</button>
        </div>
      </div>
    </div>
    
  </main>
  
  {% include 'components/chat-widget.html' %}

  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <script src="https://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-2.5.0.js"></script>
  
  <script src="{{ url_for('static', filename='config.js') }}"></script>
  <script src="{{ url_for('static', filename='app.js') }}"></script>

</body>
</html>